/assets/logo-plany-header.svg (Header-Logo)
/assets/logo-plany-mascot.svg (Plany-Maske im Hero)
  <script>
    // Jahr im Footer
    document.getElementById('y').textContent = new Date().getFullYear();

    // ---- State ----
    let trip='rt', mode='24h', pax=1;

    // Segmented Controls (groÃŸ + kompakt synchron)
    function bindSeg(containerSel, cb){
      document.querySelectorAll(containerSel+' button').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          if(btn.disabled) return;
          document.querySelectorAll(containerSel+' button').forEach(b=>b.setAttribute('aria-pressed','false'));
          btn.setAttribute('aria-pressed','true');
          cb(btn.dataset.trip || btn.dataset.mode);
          // Spiegeln in die jeweils andere Bar
          document.querySelectorAll('button[data-trip],button[data-mode]').forEach(b=>{
            if(b.dataset.trip && btn.dataset.trip) b.setAttribute('aria-pressed', b.dataset.trip===btn.dataset.trip ? 'true':'false');
            if(b.dataset.mode && btn.dataset.mode) b.setAttribute('aria-pressed', b.dataset.mode===btn.dataset.mode ? 'true':'false');
          });
        });
      });
    }
    bindSeg('.seg[aria-label="Reiseart"]', v=>trip=v);
    bindSeg('.seg[aria-label="Zeitraum"]', v=>mode=v);

    // Pax-Controller
    const paxOut = document.getElementById('pax');
    document.querySelector('.pax').addEventListener('click', e=>{
      const b=e.target.closest('button'); if(!b) return;
      pax = Math.min(9, Math.max(1, (+paxOut.value||1) + (+b.dataset.d)));
      paxOut.value = pax; paxOut.textContent = String(pax);
      const sP = document.getElementById('sPax'); if(sP) sP.value = pax;
    });

    // Von/Nach + Swap
    const from = document.getElementById('from');
    const to   = document.getElementById('to');
    from.value = 'FRA';
    document.getElementById('swap').addEventListener('click', ()=>{
      const t = from.value; from.value = to.value; to.value = t;
      const sF = document.getElementById('sFrom'), sT = document.getElementById('sTo');
      if(sF && sT){ sF.value = from.value; sT.value = to.value; }
    });

    // Geolocation â†’ nÃ¤chster groÃŸer DE-Airport (Fallback FRA)
    const airports=[{code:'FRA',lat:50.0379,lon:8.5622},{code:'BER',lat:52.3667,lon:13.5033},{code:'MUC',lat:48.3537,lon:11.7750},{code:'STR',lat:48.6899,lon:9.2219},{code:'DUS',lat:51.2895,lon:6.7668},{code:'CGN',lat:50.8659,lon:7.1427},{code:'HAM',lat:53.6304,lon:9.9882}];
    const toRad=d=>d*Math.PI/180;
    const dist=(a,b,c,d)=>{const R=6371,dLat=toRad(c-a),dLon=toRad(d-b);const A=Math.sin(dLat/2)**2+Math.cos(toRad(a))*Math.cos(toRad(c))*Math.sin(dLon/2)**2;return 2*R*Math.asin(Math.sqrt(A));};
    const nearest=(lat,lon)=>airports.reduce((m,a)=>{const dd=dist(lat,lon,a.lat,a.lon);return dd<(m.d||1e9)?{a,d:dd}:m;},{a:airports[0],d:1e9}).a;
    document.getElementById('useGeo').addEventListener('click', ()=>{
      if(!navigator.geolocation){ from.value='FRA'; return; }
      navigator.geolocation.getCurrentPosition(
        pos=>{ const a=nearest(pos.coords.latitude,pos.coords.longitude); from.value=a.code; },
        _=>{ from.value='FRA'; },
        {timeout:4000}
      );
    });

    // Sticky-Mini-Search zeigen, wenn Hero aus dem Viewport ist
    const mini = document.getElementById('miniSearch');
    const hero = document.getElementById('hero');
    const io = new IntersectionObserver(entries=>{
      entries.forEach(entry=>{
        if(entry.isIntersecting){ mini.classList.remove('visible'); mini.setAttribute('aria-hidden','true'); }
        else { mini.classList.add('visible'); mini.setAttribute('aria-hidden','false'); }
      });
    }, {rootMargin:'-100px 0px 0px 0px'}); // 100px â‰ˆ HeaderhÃ¶he
    io.observe(hero);

    // Werte zwischen groÃŸ und kompakt spiegeln
    ['input','change','keyup'].forEach(evt=>{
      const sFrom = document.getElementById('sFrom');
      const sTo   = document.getElementById('sTo');
      if(sFrom && sTo){
        from.addEventListener(evt, ()=> sFrom.value = from.value.toUpperCase());
        to.addEventListener(evt,   ()=> sTo.value   = to.value);
        sFrom.addEventListener(evt,()=> from.value = sFrom.value.toUpperCase());
        sTo.addEventListener(evt,  ()=> to.value   = sTo.value);
      }
    });

    // Suche aus beiden UIs
    function submitSearch(payload){
      console.log('SEARCH', payload);
      // TODO: fetch('/api/search', {method:'POST', headers:{'Content-Type':'application/json'}, body:JSON.stringify(payload)})
      alert('Suche gestartet:\\n' + JSON.stringify(payload,null,2));
    }
    document.getElementById('searchForm').addEventListener('submit', e=>{
      e.preventDefault();
      submitSearch({trip,mode,from:from.value.trim().toUpperCase(),to:to.value.trim(),pax});
    });
    document.getElementById('sGo').addEventListener('click', ()=>{
      const sFrom = document.getElementById('sFrom'), sTo = document.getElementById('sTo'), sP = document.getElementById('sPax');
      submitSearch({trip,mode,from:(sFrom?.value||'FRA').trim().toUpperCase(),to:(sTo?.value||'').trim(),pax:+(sP?.value||1)});
    });

    // ===== Dummy-Daten (Ticker & Karten) =====
    const hot24=[
      {route:'FRA â†’ BCN',time:'13:25',price:49,flag:'flame'},
      {route:'BER â†’ LON',time:'18:40',price:39,flag:'bolt'},
      {route:'STR â†’ ROM',time:'20:10',price:59,flag:'flame'},
      {route:'MUC â†’ LIS',time:'22:05',price:89,flag:'bolt'},
      {route:'DUS â†’ OPO',time:'06:50',price:69,flag:'flame'}
    ];
    const chipsHost = document.getElementById('hotChips');
    hot24.forEach(x=>{
      const el = document.createElement('div');
      const icon = x.flag==='bolt' ? 'âš¡' : 'ðŸ”¥';
      el.className='chip';
      el.innerHTML = `<strong>${x.route}</strong><small>${x.time}</small><span class="badge">${icon} ${x.price}â‚¬</span>`;
      chipsHost.appendChild(el);
    });

    const deals = [
      {route:'FRA â†’ BCN',meta:'Heute 21:30 â€¢ 2h 10m â€¢ Nonstop',price:49,drop:'â€“22% unter Ã¼blich',ok:'GepÃ¤ck inkl.'},
      {route:'BER â†’ LON',meta:'Morgen 07:15 â€¢ 1h 55m â€¢ 1 Stopp',price:39},
      {route:'STR â†’ ROM',meta:'Morgen 19:10 â€¢ 2h 05m â€¢ Nonstop',price:59}
    ];
    const grid = document.getElementById('dealGrid');
    deals.forEach(d=>{
      const a=document.createElement('article'); a.className='card';
      a.innerHTML = `
        <div class="media"></div>
        <div class="body">
          <div class="row">
            <div>
              <div class="route">${d.route}</div>
              <div class="meta">${d.meta}</div>
            </div>
            <div class="price">${d.price} â‚¬</div>
          </div>
          ${d.drop||d.ok ? `<div class="badges">
            ${d.drop?`<span class="b deal">${d.drop}</span>`:''}
            ${d.ok?`<span class="b ok">${d.ok}</span>`:''}
          </div>`:''}
          <a class="cta" href="#" target="_blank" rel="noopener">Jetzt buchen</a>
        </div>`;
      grid.appendChild(a);
    });
  </script>
</body>
</html>
